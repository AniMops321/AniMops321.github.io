<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Метеостанция</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Подключаем стили через относительный путь -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>Метеостанция</h1>
      <p>Точный прогноз от собственного датчика</p>
      <button id="theme-toggle">Переключить тему</button>
    </header>
    <main class="main-container">
      <div id="notification" class="hidden">Ошибка обновления данных</div>
      
      <!-- Секция текущих данных -->
      <section class="current-weather-section">
        <h2>Текущие данные</h2>
        <div class="weather-cards">
          <div class="card">
            <h3>Температура</h3>
            <p id="temperature">-- °C</p>
          </div>
          <div class="card">
            <h3>Давление</h3>
            <p id="pressure">-- hPa</p>
          </div>
          <div class="card">
            <h3>Влажность</h3>
            <p id="humidity">-- %</p>
          </div>
          <div class="card">
            <h3>Освещённость</h3>
            <p id="lux">-- лк</p>
          </div>
          <div class="card">
            <h3>Дождь</h3>
            <p id="rain_probability">-- %</p>
          </div>
          <div class="card">
            <h3>Обновлено</h3>
            <p id="timestamp">--</p>
          </div>
        </div>
      </section>
      
      <!-- Секция прогноза -->
      <section class="forecast-section">
        <h2>Прогноз на 5 измерений</h2>
        <div id="forecast-container" class="forecast-container">
          <!-- Динамически заполняется -->
        </div>
      </section>
      
      <!-- Секция графиков -->
      <section class="charts-section">
        <h2>Графики</h2>
        <div class="charts-container">
          <canvas id="temperatureChart"></canvas>
          <canvas id="humidityChart"></canvas>
          <canvas id="pressureChart"></canvas>
        </div>
      </section>
      
      <!-- Секция истории измерений -->
      <section class="history-section">
        <h2>История измерений</h2>
        <button id="download-history">Скачать данные (CSV)</button>
        <canvas id="historyChart" height="400"></canvas>
      </section>
    </main>
  </div>
  
  <!-- Глобальная переменная для прогнозных данных; будет обновляться в charts.js -->
  <script>
    window.forecastData = {
      labels: [],
      temperature: [],
      humidity: [],
      pressure: []
    };
  </script>
  
  <!-- Подключаем необходимые библиотеки -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
  <!-- Основной скрипт с обновлением динамических данных и графиками -->
  <script src="charts.js"></script>
  
  <!-- Обработчики кнопок -->
  <script>
    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
    });
    document.getElementById('download-history').addEventListener('click', () => {
      window.location.href = "download/history";
    });
  </script>
</body>
</html>
